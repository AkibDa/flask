{% extends "base.html" %}

{% block content %}

  <h1>Index Page</h1>

  <ul>
    {% for person in people %}
      <li>{{person}} <button onclick='deletePerson({{person.pid}})'>Delete</button><a href="{{url_for('details', pid=person.pid)}}">Details</a></li>
    {% endfor %}
  </ul>

  <h3>New Person</h3>
  <form action="/" method="POST">
    <label for="name">Name:</label>
    <input type="text" name="name" required>

    <label for="age">Age:</label>
    <input type="number" name="age" required>

    <label for="job">Job:</label>
    <input type="text" name="job" required>

    <button type="submit">Submit</button>
  </form>
  <script type='text/javascript'>
    function deletePerson(pid){
      fetch('{{url_for('delete', pid=pid)}}' + pid, {
        method: 'DELETE'
      }).then(response => {
        if(response.ok){
          window.location.reload();
        } else {
          console.error('Failed to delete item with pid: ', pid);
        }
      })
      .catch(error => {
        console.error('Error during fetching: ',error);
      })
    }
  </script>
{% endblock content %}